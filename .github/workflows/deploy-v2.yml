name: build & deploy

on:
    push:
        branches:
            - esds-2.0-visual-identity
            - deploy-to-new-url
    pull_request:
        branches:
            - esds-2.0-visual-identity
            - deploy-to-new-url

jobs:
    #ci:
        #uses: ./.github/workflows/ci.yml

    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Restore build ğŸ—ƒï¸
              uses: actions/cache/restore@v4
              with:
                path: |
                    ./
                key: |
                    ${{ github.head_ref || github.ref_name }}-${{ github.sha }}-${{ inputs.environment }}

            - name: Log into aws dev ğŸ”‘
              uses: ./.github/actions/login
              with:
                aws-access-key-id: ${{ secrets.ES_DS_DEV_AWS_ACCESS_KEY_ID }}
                aws-secret-access-key: ${{ secrets.ES_DS_DEV_AWS_SECRET_KEY }}

            - name: Building ES-DS version 2
              working-directory: ./es-design-system
              shell: bash
              run: |
                npx nuxt generate

            - name: Deploying to S3 ğŸ“
              working-directory: ./es-design-system
              shell: bash
              run: |
                aws s3 cp ./dist/ s3://es-ds-version-2


